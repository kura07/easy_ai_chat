<!DOCTYPE html>
<html>

<head>
  <title>Easy AI Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <script>
    const link = document.createElement('link');
    link.rel = "stylesheet";
    link.href = `chat.css?t=${Date.now()}`;
    document.head.appendChild(link);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/turndown/dist/turndown.min.js"></script>
</head>

<body>

  <section id="chat">

    <template id="template-user">
      <article class="user" data-role="user" contenteditable="true"></article>
    </template>

    <template id="template-model">
      <article class="model" data-role="model" data-markdown="" contenteditable="true"></article>
    </template>

    <template id="template-user-image">
      <article class="user-image" data-role="user-image">
        <figure data-uploading="true">
          <a href="" target="_blank"><img src=""></a>
          <button class="button-delete-image">✕</button>
        </figure>
      </article>
    </template>

    <button id="generate-from-middle" hidden>↻</button>
  </section>

  <section id="input">
    <article id="input-user-image" class="user-image" data-role="user-image"></article>
    <article><textarea id="input-user" placeholder="ユーザーの入力"></textarea></article>
    <article><textarea id="input-model" placeholder="モデルの出力の固定" hidden></textarea></article>
    <button id="generate" disabled>↑</button>
    <aside id="error-message" hidden></aside>
  </section>

  <aside id="menu">
    <details>
      <summary>☰ v0.11</summary>
      <nav>
        <ul>
          <li><button id="clear_all_local_storage" ontouchstart="">clear all localStorage</button>
          <li><button id="set_gemini_api_key" ontouchstart="">set Gemini API key</button>
          <li><button id="set_cloudinary_api_key" ontouchstart="">set Cloudinary API key</button>
          <li><button id="check_local_stotage" ontouchstart="">check localStorage</button>
          <li><button id="overwrite_messages" ontouchstart="">overwrite messages</button>
          <li><button id="delete_messages" ontouchstart="">delete messages</button>
        </ul>
      </nav>
    </details>
  </aside>

  <script>
    /** @param {string[]} sources */
    function insertScriptInOrder(sources) {
      const loadNext = i => {
        const script = document.createElement("script");
        script.src = `${sources[i]}?t=${Date.now()}`;
        if (i < sources.length - 1) script.onload = () => loadNext(i + 1); // 次のスクリプトを読み込む
        document.body.appendChild(script);
      };
      loadNext(0);
    }
    insertScriptInOrder(["library.js", "chat.js"]);
  </script>

</body>

</html>